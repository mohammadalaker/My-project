# تحديث المنتجات حسب الإكسل

لتحديث قائمة المنتجات في التطبيق وفق ملف الإكسل:

## 1. تشغيل التحديث

من مجلد المشروع (الجذر):

```bash
npm run update-products
```

أو من مجلد `my-website`:

```bash
npm run update-products
```

أو مباشرة:

```bash
npm run read-excel
```

## 2. ماذا يفعل التحديث؟

1. **مزامنة صور Electric**  
   نسخ صور مجلد `Electric` إلى `public/electric` وتحديث `electricByBarcode.json`.

2. **قراءة ملف الإكسل**  
   قراءة **جميع الـ sheets** من الملف:  
   `كشف القطع الصغيرة و المنزلي.xlsx`  
   (يجب أن يكون الملف في مجلد المشروع الجذر، بجانب مجلد `my-website`).

3. **ربط الصور حسب الباركود من Electric**  
   - أولاً: مزامنة مجلد `Electric` → نسخ الصور إلى `public/electric` وبناء `electricByBarcode.json` (الباركود مأخوذ من اسم الملف، مثلاً `7290020124197.jpg`).  
   - صور Electric لها **الأولوية**: إن وُجدت صورة في Electric بنفس الباركود تُستخدم للمنتج.  
   - صور مضمّنة في الإكسل → تُستخرج إلى `public/inventory-images` وتُربط بالمنتجات.  
   - المنتج يُعرض بصورة Electric إن وُجدت، وإلا صورة الإكسل، وإلا بدون صورة.

4. **كتابة النتيجة**  
   يتم تحديث الملف:  
   `my-website/src/data/inventoryFromExcel.json`.

## 3. بعد التحديث

حدّث الصفحة في المتصفح (F5 أو Ctrl+R) لرؤية المنتجات والأسعار والمخزون المحدثة.

## 4. أعمدة الإكسل المدعومة

يتم التعرف على الأعمدة تلقائياً حسب العنوان (بالعربي أو الإنجليزي):

| البيانات      | أمثلة عناوين الأعمدة                          |
|---------------|-----------------------------------------------|
| الاسم/الوصف   | الوصف، Name، Description، اسم القطعة          |
| الكمية        | الكمية، Qty، Quantity                         |
| السعر         | السعر، Price                                  |
| السعر بعد الخصم | السعر بعد الخصم، Price after discount       |
| مبلغ الخصم     | مبلغ الخصم، الخصم، Discount amount، Discount (يُحسب منه السعر بعد الخصم = السعر − مبلغ الخصم إذا لم يكن عمود «السعر بعد الخصم» معبّى) |
| المجموعة/الصنف | المجموعة، Group، صنف، ماركة، Brand           |
| الباركود      | باركود، Barcode                               |
| الصندوق       | صندوق، Box                                    |
| المخزون       | Stock، المخزون                                |

إذا تغير ترتيب الأعمدة في الإكسل، السكربت يظل يقرأ البيانات من العنوان وليس من موقع العمود فقط.

## 5. تحديث الصور من Electric فقط

إذا أضفت صوراً جديدة في مجلد **Electric** (بجانب مجلد `my-website`) وأسميتها باسم الباركود (مثلاً `7290020124197.jpg` أو `7290-020-124-197.png`):

- لتحديث **كل** المنتجات والصور: شغّل `npm run update-products` (مزامنة Electric + قراءة الإكسل).
- لتحديث **صور Electric فقط** دون إعادة قراءة الإكسل: شغّل `npm run sync-electric` أو `npm run update-electric`، ثم أعد تحميل التطبيق (أو أعد تشغيل `npm run dev`) لتحميل `electricByBarcode.json` الجديد.

## 6. حذف المنتجات غير الموجودة في الإكسل من Supabase

إذا رفعت المنتجات إلى Supabase (جدول `items`) وتريد **حذف أي صنف من Supabase لا يظهر في ملف الإكسل**:

1. ضع ملف الإكسل في مكانه: `كشف القطع الصغيرة و المنزلي.xlsx` (في مجلد المشروع الجذر).
2. تأكد من وجود متغيرات البيئة في `my-website/.env`: `VITE_SUPABASE_URL` و `VITE_SUPABASE_ANON_KEY`.
3. شغّل:

```bash
cd my-website
npm run delete-not-in-excel
```

السكربت يقرأ كل الباركودات من الإكسل، يجلب كل أصناف جدول `items` من Supabase، ويحذف كل صنف باركوده **غير موجود** في الإكسل. النتيجة: محتويات Supabase تطابق الإكسل (من حيث وجود/عدم وجود الباركود).
